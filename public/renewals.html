<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPDA Renewals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom Scrollbar for Modal */
        .modal-scroll::-webkit-scrollbar { width: 6px; }
        .modal-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .modal-scroll::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .modal-scroll::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="bg-gray-50 font-sans relative h-screen overflow-hidden flex">

    <div class="w-64 bg-white border-r border-gray-200 flex-col hidden sm:flex z-10" id="sidebar">
        <div class="p-4 flex items-center space-x-2">
            <div class="bg-blue-100 p-2 rounded-lg">
                <i data-feather="users" class="text-blue-600"></i>
            </div>
            <span class="font-bold text-gray-800">SPDA System</span>
        </div>

        <nav class="flex-1 px-2 space-y-1 overflow-y-auto">
            <a href="dashboard.html" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-100">
                <i data-feather="home" class="mr-3"></i> Dashboard </a>
            <a href="reports.html" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-blue-600 bg-blue-50 hover:bg-blue-100 sidebar-link">
                <i data-feather="file" class="mr-3"></i> Data Reports </a>
            <a href="members.html" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-100">
                <i data-feather="users" class="mr-3"></i> Members </a>
            <a href="applications.html" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-100">
                <i data-feather="file-text" class="mr-3"></i> Applications </a>
            <a href="renewals.html" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-blue-600 bg-blue-50 hover:bg-blue-100">
                <i data-feather="refresh-cw" class="mr-3"></i> Renewals </a>
            <a href="announcements.html" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-100">
                <i data-feather="bell" class="mr-3"></i> Announcements </a>
        </nav>

        <div class="p-4 border-t border-gray-200">
            <button id="logout-btn" class="w-full flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i data-feather="log-out" class="mr-2"></i> Log Out
            </button>
        </div>
    </div>

    <div class="flex-1 flex flex-col overflow-hidden relative">
        <div class="flex-1 overflow-auto p-6">
            <div class="mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-1">Pending Renewal Requests</h1>
                <p class="text-gray-500 text-sm">Review and approve ID renewal applications.</p>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Request Type</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date Submitted</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="renewals-table-body" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                                    Loading renewals...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="viewModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden z-50 flex items-center justify-center px-4">
        <div class="relative bg-gray-100 rounded-xl shadow-2xl max-w-6xl w-full m-auto flex flex-col max-h-[90vh] overflow-hidden">
            
            <div class="flex justify-between items-center px-6 py-4 bg-white border-b border-gray-200">
                <div>
                    <h3 class="text-xl font-bold text-gray-800">Renewal Application</h3>
                    <p class="text-xs text-gray-500">Home / Renewals / Profile</p>
                </div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition"><i data-feather="x" class="w-6 h-6"></i></button>
            </div>

            <div class="overflow-y-auto modal-scroll p-6">
                <div class="flex flex-col md:flex-row gap-6">
                    
                    <div class="w-full md:w-1/3 space-y-6">
                        <div class="bg-white rounded-lg shadow-sm p-6 text-center border border-gray-200">
                            <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span id="v-avatar" class="text-4xl font-bold text-blue-600">U</span>
                            </div>
                            
                            <h2 id="m-fullname-header" class="text-xl font-bold text-gray-900">User Name</h2>
                            <p class="text-sm text-gray-500 mb-6">ID Renewal Request</p>

                            <div class="border-t border-gray-100 my-4"></div>

                            <div class="text-left space-y-4">
                                <div><p class="text-xs text-gray-400 uppercase font-bold mb-1">Email</p><p id="m-email-card" class="text-sm font-medium text-gray-800 break-all"></p></div>
                                <div><p class="text-xs text-gray-400 uppercase font-bold mb-1">Address</p><p id="m-address-card" class="text-sm font-medium text-gray-800"></p></div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <button id="btn-approve-view" class="w-full py-2 bg-green-600 text-white rounded-md font-medium hover:bg-green-700 transition flex items-center justify-center gap-2">
                                <i data-feather="check-circle" class="w-4 h-4"></i> Approve
                            </button>
                            <button id="btn-reject-view" class="w-full py-2 bg-red-600 text-white rounded-md font-medium hover:bg-red-700 transition flex items-center justify-center gap-2">
                                <i data-feather="x-circle" class="w-4 h-4"></i> Reject
                            </button>
                        </div>
                    </div>

                    <div class="w-full md:w-2/3 space-y-6">
                        
                        <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-6">Personal Information</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-6 gap-x-4">
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Full Name</p><p id="m-fullname" class="text-sm font-medium text-gray-900"></p></div>
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Date of Birth</p><p id="m-dob" class="text-sm font-medium text-gray-900"></p></div>
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Age</p><p id="m-age" class="text-sm font-medium text-gray-900"></p></div>
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Sex</p><p id="m-sex" class="text-sm font-medium text-gray-900"></p></div>
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Civil Status</p><p id="m-civil" class="text-sm font-medium text-gray-900"></p></div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-6">Family & Employment</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-6 gap-x-4">
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Occupation</p><p id="m-occupation" class="text-sm font-medium text-gray-900"></p></div>
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Monthly Income</p><p id="m-income" class="text-sm font-medium text-gray-900"></p></div>
                                <div><p class="text-xs text-gray-400 uppercase font-bold">Children Count</p><p id="m-numChildren" class="text-sm font-medium text-gray-900"></p></div>
                                <div class="sm:col-span-2"><p class="text-xs text-gray-400 uppercase font-bold">Children's Ages</p><p id="m-childrenAges" class="text-sm font-medium text-gray-900"></p></div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-6">Uploaded Documents</h4>
                            <div class="grid grid-cols-1 gap-6">
                                <div>
                                    <p class="text-xs font-bold text-gray-700 mb-2">Valid ID</p>
                                    <div class="border rounded-lg p-2 bg-gray-50 flex justify-center">
                                        <img id="img-validId" src="" class="max-h-64 object-contain hidden">
                                        <p id="no-img-validId" class="text-xs text-gray-400 py-4">No image</p>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-xs font-bold text-gray-700 mb-2">Solo Parent ID</p>
                                    <div class="border rounded-lg p-2 bg-gray-50 flex justify-center">
                                        <img id="img-soloParent" src="" class="max-h-64 object-contain hidden">
                                        <p id="no-img-soloParent" class="text-xs text-gray-400 py-4">No image</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="px-6 py-4 border-t border-gray-200 bg-white flex justify-end">
                <button onclick="closeModal()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 font-medium text-sm transition">Close Window</button>
            </div>
        </div>
    </div>

    <div id="rejectModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[60] flex items-center justify-center px-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full overflow-hidden">
            <div class="bg-red-50 px-6 py-4 border-b border-red-100 flex justify-between items-center">
                <h3 class="text-lg font-bold text-red-800 flex items-center gap-2">
                    <i data-feather="alert-circle" class="w-5 h-5"></i> Reject Renewal
                </h3>
                <button onclick="closeRejectModal()" class="text-red-400 hover:text-red-600"><i data-feather="x" class="w-5 h-5"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <p class="text-sm text-gray-600">Please select or enter a reason for rejection.</p>
                <select id="reject-select" class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-red-500 focus:border-red-500" onchange="updateRejectText()">
                    <option value="">-- Choose Reason --</option>
                    <option value="Incomplete documentation.">Incomplete Documents</option>
                    <option value="Expired ID or requirements.">Expired Requirements</option>
                    <option value="Information mismatch.">Info Mismatch</option>
                    <option value="Other">Other (Type manually)</option>
                </select>
                <textarea id="reject-reason-text" rows="3" class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-red-500 focus:border-red-500" placeholder="Detailed reason..."></textarea>
            </div>
            <div class="px-6 py-4 bg-gray-50 flex justify-end gap-3 border-t border-gray-100">
                <button onclick="closeRejectModal()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md text-sm hover:bg-gray-50">Cancel</button>
                <button onclick="confirmRejectSubmission()" class="px-4 py-2 bg-red-600 text-white rounded-md text-sm hover:bg-red-700">Submit Rejection</button>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[70] flex items-center justify-center px-4">
        <div class="bg-white rounded-lg shadow-xl max-w-sm w-full p-6 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4" id="confirm-icon-bg">
                <i data-feather="alert-triangle" class="h-6 w-6 text-blue-600" id="confirm-icon"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900" id="confirm-title">Confirm Action</h3>
            <p class="text-sm text-gray-500 mt-2" id="confirm-message">Are you sure you want to proceed?</p>
            <div class="mt-6 flex justify-center gap-3">
                <button onclick="closeConfirmModal()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md text-sm hover:bg-gray-50">Cancel</button>
                <button id="confirm-btn-action" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700">Yes, Proceed</button>
            </div>
        </div>
    </div>

    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[80] flex items-center justify-center px-4">
        <div class="bg-white rounded-lg shadow-xl max-w-sm w-full p-6 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                <i data-feather="check" class="h-6 w-6 text-green-600"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900">Success!</h3>
            <p class="text-sm text-gray-500 mt-2" id="success-message">Action completed successfully.</p>
            <div class="mt-6">
                <button onclick="closeSuccessModal()" class="w-full px-4 py-2 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 shadow-sm">OK</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        feather.replace();

        console.log("üéØ renewals.js embedded!");

        let cachedRenewals = {};
        let rejectTargetId = null;
        let rejectTargetUserId = null;
        let approveTargetId = null;
        let approveTargetUserId = null;
        let pendingRejectReason = "";

        document.addEventListener('DOMContentLoaded', async function() {
            const tbody = document.getElementById('renewals-table-body');
            try {
                tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-gray-500">Loading, please wait...</td></tr>';

                const firebaseConfig = {
                    apiKey: "AIzaSyBjO4P1-Ir_iJSkLScTiyshEd28GdskN24",
                    authDomain: "solo-parent-app.firebaseapp.com",
                    databaseURL: "https://solo-parent-app-default-rtdb.asia-southeast1.firebasedatabase.app",
                    projectId: "solo-parent-app",
                    storageBucket: "solo-parent-app.firebasestorage.app",
                    messagingSenderId: "292578110807",
                    appId: "1:292578110807:web:9f5e5c0dcd73c9975e6212"
                };
                
                if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
                const db = firebase.firestore();
                console.log("‚úÖ Firebase initialized");

                // Load Data
                let snapshot = await db.collection("renewalSubmissions").where("renewal_status", "==", "pending").get();
                if (snapshot.empty) {
                    snapshot = await db.collection("renewalSubmissions").where("status", "==", "pending").get();
                }

                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="4" class="px-6 py-8 text-center text-yellow-500">‚ÑπÔ∏è No pending renewals.</td></tr>`;
                    return;
                }

                displayRenewals(snapshot, tbody);

            } catch (error) {
                console.error("‚ùå Error:", error);
                tbody.innerHTML = `<tr><td colspan="4" class="px-6 py-8 text-center text-red-500">Error: ${error.message}</td></tr>`;
            }
        });

        function displayRenewals(snapshot, tbody) {
            tbody.innerHTML = "";
            snapshot.forEach(doc => {
                const data = doc.data();
                cachedRenewals[doc.id] = data;
                const name = `${data.firstName || ''} ${data.middleInitial ? data.middleInitial + '.' : ''} ${data.lastName || ''}`.trim() || 'Unknown';
                const date = data.submittedAt ? data.submittedAt.toDate().toLocaleDateString() : 'N/A';

                const row = document.createElement('tr');
                row.className = "hover:bg-gray-50 border-b border-gray-100 last:border-0 transition";
                row.innerHTML = `
                    <td class="px-6 py-4 font-bold text-gray-900">${name}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">ID Renewal</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${date}</td>
                    <td class="px-6 py-4 text-right text-sm font-medium">
                        <div class="flex justify-end gap-2">
                            <button class="bg-blue-600 text-white px-3 py-1.5 rounded text-xs hover:bg-blue-700" onclick="handleView('${doc.id}')">View</button>
                            <button class="bg-green-600 text-white px-3 py-1.5 rounded text-xs hover:bg-green-700" onclick="confirmApprove('${doc.id}', '${data.userId}')">Approve</button>
                            <button class="bg-red-600 text-white px-3 py-1.5 rounded text-xs hover:bg-red-700" onclick="openRejectModal('${doc.id}', '${data.userId}')">Reject</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // --- ACTIONS ---

        // View Modal (Card Style)
        window.handleView = function(id) {
            const data = cachedRenewals[id];
            if (!data) return;

            const setTxt = (id, val) => { const el = document.getElementById(id); if(el) el.textContent = val || "N/A"; };
            const setImg = (id, noId, url) => {
                const img = document.getElementById(id); const txt = document.getElementById(noId);
                if (url && url.length > 5) { img.src = url; img.classList.remove('hidden'); txt.classList.add('hidden'); }
                else { img.classList.add('hidden'); txt.classList.remove('hidden'); }
            };

            const fullName = `${data.firstName} ${data.lastName}`;
            setTxt('m-fullname-header', fullName);
            setTxt('v-avatar', (data.firstName || 'U').charAt(0).toUpperCase());
            
            // Address
            let addr = [data.houseNumber, data.streetName, data.subdivision].filter(Boolean).join(' ');
            if (data.barangay) addr += (addr ? ', ' : '') + data.barangay;
            if (data.municipality || data.city) addr += ', ' + (data.municipality || data.city);
            setTxt('m-address-card', addr || data.address);
            setTxt('m-email-card', data.email);

            // Bind Sidebar Buttons
            document.getElementById('btn-approve-view').onclick = () => { closeModal(); confirmApprove(id, data.userId); };
            document.getElementById('btn-reject-view').onclick = () => { closeModal(); openRejectModal(id, data.userId); };

            // Details
            setTxt('m-fullname', fullName);
            setTxt('m-dob', data.dateOfBirth);
            setTxt('m-age', data.age);
            setTxt('m-sex', data.sex);
            setTxt('m-civil', data.civilStatus);
            setTxt('m-occupation', data.occupation);
            setTxt('m-income', data.monthlyIncome);
            setTxt('m-numChildren', data.numberOfChildren);
            setTxt('m-childrenAges', (Array.isArray(data.childrenAges) ? data.childrenAges.join(', ') : "None"));

            setImg('img-validId', 'no-img-validId', data.proofIdUrl);
            setImg('img-soloParent', 'no-img-soloParent', data.proofSoloParentUrl);

            document.getElementById('viewModal').classList.remove('hidden');
        };
        window.closeModal = function() { document.getElementById('viewModal').classList.add('hidden'); };


        // ============================
        //    APPROVAL LOGIC (NEW)
        // ============================
        window.confirmApprove = function(subId, userId) {
            approveTargetId = subId;
            approveTargetUserId = userId;

            document.getElementById('confirm-title').innerText = "Confirm Approval";
            document.getElementById('confirm-message').innerText = "Are you sure you want to approve this renewal request?";
            
            const btn = document.getElementById('confirm-btn-action');
            btn.className = "px-4 py-2 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 transition";
            btn.innerText = "Yes, Approve";
            btn.onclick = finalizeApprove;

            document.getElementById('confirmModal').classList.remove('hidden');
        };

        window.finalizeApprove = async function() {
            const btn = document.getElementById('confirm-btn-action');
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                const db = firebase.firestore();
                const batch = db.batch();

                batch.update(db.collection("renewalSubmissions").doc(approveTargetId), { 
                    status: "approved", renewal_status: "approved", reviewedDate: firebase.firestore.FieldValue.serverTimestamp() 
                });
                batch.update(db.collection("users").doc(approveTargetUserId), { 
                    renewal_status: "approved", lastRenewalDate: firebase.firestore.FieldValue.serverTimestamp() 
                });

                await batch.commit();
                document.getElementById('confirmModal').classList.add('hidden');
                showSuccessModal("Renewal Approved Successfully!");
            } catch (error) { 
                alert("Error: " + error.message); 
                document.getElementById('confirmModal').classList.add('hidden');
                btn.disabled = false;
            }
        };


        // ============================
        //    REJECTION LOGIC
        // ============================
        window.openRejectModal = function(subId, userId) {
            rejectTargetId = subId;
            rejectTargetUserId = userId;
            document.getElementById('reject-select').value = "";
            document.getElementById('reject-reason-text').value = "";
            document.getElementById('rejectModal').classList.remove('hidden');
        };

        window.closeRejectModal = function() {
            document.getElementById('rejectModal').classList.add('hidden');
            rejectTargetId = null;
        };

        window.updateRejectText = function() {
            const select = document.getElementById('reject-select');
            const text = document.getElementById('reject-reason-text');
            if(select.value === "Other") { text.value = ""; text.placeholder = "Type reason..."; } 
            else { text.value = select.value; }
        };

        window.confirmRejectSubmission = function() {
            pendingRejectReason = document.getElementById('reject-reason-text').value;
            if(!pendingRejectReason) { alert("Please enter a reason"); return; }
            
            document.getElementById('rejectModal').classList.add('hidden');
            
            document.getElementById('confirm-title').innerText = "Confirm Rejection";
            document.getElementById('confirm-message').innerText = "Are you sure you want to reject this renewal?";
            
            const btn = document.getElementById('confirm-btn-action');
            btn.className = "px-4 py-2 bg-red-600 text-white rounded-md text-sm hover:bg-red-700 transition";
            btn.innerText = "Yes, Reject";
            btn.onclick = finalizeRejection;

            document.getElementById('confirmModal').classList.remove('hidden');
        };

        window.closeConfirmModal = function() {
            document.getElementById('confirmModal').classList.add('hidden');
            if (rejectTargetId && !approveTargetId) {
                document.getElementById('rejectModal').classList.remove('hidden');
            }
            approveTargetId = null;
        };

        window.finalizeRejection = async function() {
            const btn = document.getElementById('confirm-btn-action');
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                const db = firebase.firestore();
                const batch = db.batch();

                batch.update(db.collection("renewalSubmissions").doc(rejectTargetId), { 
                    status: "rejected", renewal_status: "rejected", rejectionReason: pendingRejectReason, reviewedDate: firebase.firestore.FieldValue.serverTimestamp() 
                });
                batch.update(db.collection("users").doc(rejectTargetUserId), { 
                    renewal_status: "rejected" 
                });
                
                await batch.commit();
                document.getElementById('confirmModal').classList.add('hidden');
                showSuccessModal("Renewal Rejected Successfully.");
            } catch (error) { 
                alert("Error: " + error.message); 
                document.getElementById('confirmModal').classList.add('hidden');
                btn.disabled = false;
            }
        };

        window.showSuccessModal = function(msg) {
            if(document.getElementById('successModal')) {
                document.getElementById('success-message').innerText = msg;
                document.getElementById('successModal').classList.remove('hidden');
            } else { alert(msg); location.reload(); }
        };
        window.closeSuccessModal = function() { location.reload(); };
    </script>
</body>
</html>